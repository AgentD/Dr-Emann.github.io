<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>Squashfs Format (WIP)</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="icon" href="images/favicon.png">

    <style type="text/css">
        .field-name {
            color: #e39619;
            display: inline-block;
        }

        .flag-name {
            color: #ff00ce;
        }

        pre {
            background-color: #f8f9fa;
        }

        .avoid-split {
            display: inline-block;
        }

        BODY {
            margin-top: 75px;
        }

        *[id]:before {
            display: block;
            content: " ";
            margin-top: -75px;
            height: 75px;
            visibility: hidden;
        }

    </style>
</head>

<body>
    <nav class="navbar fixed-top navbar-expand-md navbar-light bg-light">
        <a class="navbar-brand" href="#">Squashfs Format</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Sections</a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <a class="dropdown-item" href="#superblock">Superblock</a>
                        <a class="dropdown-item" href="#compression-options">Compression Options</a>
                        <a class="dropdown-item" href="#datablocks-and-fragments">Datablocks &amp; Fragments</a>
                        <a class="dropdown-item" href="#inode-table">Inode Table</a>
                        <a class="dropdown-item" href="#fragment-table">Fragment Table</a>
                        <a class="dropdown-item" href="#id-table">UID/GID Table</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="#">Something else here</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="https://github.com/plougher/squashfs-tools">Repo</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="https://www.kernel.org/doc/Documentation/filesystems/squashfs.txt">Kernel Docs</a>
                </li>
            </ul>
        </div>
    </nav>

    <div id="main-container" class="container">
        <div class="row">
            <div class="col">
                <h1 class="display-3">Squashfs Binary Format (WIP)</h1>
            </div>
        </div>
        <div class="row">
            <div class="col-12">
                <p>
                    A squashfs filesystem consists of a maximum of nine parts, packed together on a byte alignment:
                </p>
                <table class="table table-bordered">
                    <tr>
                        <td><a href="#superblock"><span class="float-lg-left">Superblock</span>
                            <div class="text-muted d-block d-lg-inline-block float-none float-lg-right">Important information about the archive, including locations of other sections</div></a>
                        </td>
                    </tr>
                    <tr>
                        <td><a href="#compression-options"><span class="float-lg-left">Compression Options</span>
                            <div class="text-muted d-block d-lg-inline-block float-none float-lg-right">If non-default compression options have been used, then these are stored here.</div></a>
                        </td>
                    </tr>
                    <tr>
                        <td><a href="#datablocks-and-fragments"><span class="float-lg-left">Datablocks &amp; Fragments</span></a>
                            <div class="text-muted d-block d-lg-inline-block float-none float-lg-right">The contents of the files in the archive, split into blocks</div>
                        </td>
                    </tr>
                    <tr>
                        <td><a href="#inode-table"><span class="float-lg-left">Inode Table</span>
                            <div class="text-muted d-block d-lg-inline-block float-none float-lg-right">Metadata (ownership, permissions, etc) for items in the archive</div>
                            </a>
                        </td>
                    </tr>
                    <tr>
                        <td><span class="float-lg-left">Directory Table</span>
                            <div class="text-muted d-block d-lg-inline-block float-none float-lg-right">Directory listings, including file names, and references to inodes</div>
                        </td>
                    </tr>
                    <tr>
                        <td><a href="#fragment-table"><span class="float-lg-left">Fragment Table</span>
                            <div class="text-muted d-block d-lg-inline-block float-none float-lg-right">Description of fragment locations within the Datablocks &amp; Fragments section</div>
                            </a>
                        </td>
                    </tr>
                    <tr>
                        <td><span class="float-lg-left">Export Table</span>
                            <div class="text-muted d-block d-lg-inline-block float-none float-lg-right">A mapping from inode numbers to disk locations, required for NFS export</div>
                        </td>
                    </tr>
                    <tr>
                        <td><a href="#id-table"><span class="float-lg-left">UID/GID Lookup Table</span>
                            <div class="text-muted d-block d-lg-inline-block float-none float-lg-right">A list of UID/GIDs. IDs are referenced as an index into this table</div></a>
                        </td>
                    </tr>
                    <tr>
                        <td>Xattr Table
                            <div class="text-muted d-block d-lg-inline-block float-none float-lg-right">Xattrs for items in the archive</div>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="col">
                <section id="superblock">
                    <h1>The superblock</h1>
                    <p>
                        The superblock is the first section of a squashfs archive, and contains important information about the archive, including the locations of other sections of the archive.
                    </p>
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Type</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code class="field-name">magic</code></td>
                                <td>u32</td>
                                <td>Must match the value of <code>0x73717368</code> to be considered a squashfs archive</td>
                            </tr>
                            <tr>
                                <td><code class="field-name">inode_count</code></td>
                                <td>u32</td>
                                <td>The number of inodes stored in the inode table</td>
                            </tr>
                            <tr>
                                <td><code class="field-name">modification_time</code></td>
                                <td>i32</td>
                                <td>The number of seconds (not counting leap seconds) since 00:00, Jan&nbsp;1&nbsp;1970 UTC when the archive was created (or last appended to)</td>
                            </tr>
                            <tr>
                                <td><code class="field-name">block_size</code></td>
                                <td>u32</td>
                                <td>The size of a data block in bytes. Must be a power of two between 4096 and 1048576 (1 MiB)</td>
                            </tr>
                            <tr>
                                <td><code class="field-name">fragment_entry_count</code></td>
                                <td>u32</td>
                                <td>The number of entries in the fragment table</td>
                            </tr>
                            <tr>
                                <td><code class="field-name">compression_id</code></td>
                                <td>u16</td>
                                <td>
                                    <div class="row">
                                        <div class="col-12 col-sm-6 col-md-3">1&nbsp;-&nbsp;GZIP</div>
                                        <div class="col-12 col-sm-6 col-md-3">2&nbsp;-&nbsp;LZMA</div>
                                        <div class="col-12 col-sm-6 col-md-3">3&nbsp;-&nbsp;LZO</div>
                                        <div class="col-12 col-sm-6 col-md-3">4&nbsp;-&nbsp;XZ</div>
                                        <div class="col-12 col-sm-6 col-md-3">5&nbsp;-&nbsp;LZ4</div>
                                        <div class="col-12 col-sm-6 col-md-3">6&nbsp;-&nbsp;ZSTD</div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td><code class="field-name">block_log</code></td>
                                <td>u16</td>
                                <td>The log<sub>2</sub> of <code class="field-name">block_size</code>. If <code class="field-name">block_size</code> and <code class="field-name">block_log</code> do not agree, the archive is considered corrupt</td>
                            </tr>
                            <tr>
                                <td><code class="field-name">flags</code></td>
                                <td>u16<br/>(<a href="#superblock-flags">Flags</a>)</td>
                                <td><em>See <a href="#superblock-flags">Superblock Flags</a></em></td>
                            </tr>
                            <tr>
                                <td><code class="field-name">id_count</code></td>
                                <td>u16</td>
                                <td>The number of entries in the id lookup table</td>
                            </tr>
                            <tr>
                                <td><code class="field-name">version_major</code></td>
                                <td>u16</td>
                                <td>The major version of the squashfs file format. Should always equal 4</td>
                            </tr>
                            <tr>
                                <td><code class="field-name">version_minor</code></td>
                                <td>u16</td>
                                <td>The minor version of the squashfs file format. Should always equal 0</td>
                            </tr>
                            <tr>
                                <td><code class="field-name">root_inode_ref</code></td>
                                <td>u64<br/>(<a href="#InodeRef">InodeRef</a>)</td>
                                <td>A reference to the inode of the root directory of the archive</td>
                            </tr>
                            <tr>
                                <td><code class="field-name">bytes_used</code></td>
                                <td>u64</td>
                                <td>The number of bytes used by the archive. Because squashfs archives are often padded to 4KiB, this can often be less than the file size</td>
                            </tr>
                            <tr>
                                <td><code class="field-name">id_table_start</code></td>
                                <td>u64</td>
                                <td>The byte offset at which the id table starts</td>
                            </tr>
                            <tr>
                                <td><code class="field-name">xattr_id_table_start</code></td>
                                <td>u64</td>
                                <td>The byte offset at which the xattr id table starts</td>
                            </tr>
                            <tr>
                                <td><code class="field-name">inode_table_start</code></td>
                                <td>u64</td>
                                <td>The byte offset at which the inode table starts</td>
                            </tr>
                            <tr>
                                <td><code class="field-name">directory_table_start</code></td>
                                <td>u64</td>
                                <td>The byte offset at which the directory table starts</td>
                            </tr>
                            <tr>
                                <td><code class="field-name">fragment_table_start</code></td>
                                <td>u64</td>
                                <td>The byte offset at which the fragment table starts</td>
                            </tr>
                            <tr>
                                <td><code class="field-name">export_table_start</code></td>
                                <td>u64</td>
                                <td>The byte offset at which the export table starts</td>
                            </tr>
                        </tbody>
                    </table>
                </section>

                <section id="superblock-flags">
                    <h1>Superblock Flags</h1>

                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Value</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code class="flag-name">UNCOMPRESSED_INODES</code></td>
                                <td>0x0001</td>
                                <td>Inodes are stored uncompressed. For backward compatibility reasons, UID/GIDs are also stored uncompressed.</td>
                            </tr>
                            <tr>
                                <td><code class="flag-name">UNCOMPRESSED_DATA</code></td>
                                <td>0x0002</td>
                                <td>Data are stored uncompressed</td>
                            </tr>
                            <tr>
                                <td><code class="flag-name">CHECK</code></td>
                                <td>0x0004</td>
                                <td>Unused in squashfs 4+. Should always be unset</td>
                            </tr>
                            <tr>
                                <td><code class="flag-name">UNCOMPRESSED_FRAGMENTS</code></td>
                                <td>0x0008</td>
                                <td>Fragments are stored uncompressed</td>
                            </tr>
                            <tr>
                                <td><code class="flag-name">NO_FRAGMENTS</code></td>
                                <td>0x0010</td>
                                <td>Fragments are not used. Files smaller than the block size are stored in a full block.</td>
                            </tr>
                            <tr>
                                <td><code class="flag-name">ALWAYS_FRAGMENTS</code></td>
                                <td>0x0020</td>
                                <td>If the last block of a file is smaller than the block size, it will be instead stored as a fragment</td>
                            </tr>
                            <tr>
                                <td><code class="flag-name">DUPLICATES</code></td>
                                <td>0x0040</td>
                                <td>Identical files are recognized, and stored only once</td>
                            </tr>
                            <tr>
                                <td><code class="flag-name">EXPORTABLE</code></td>
                                <td>0x0080</td>
                                <td>Filesystem has support for export via NFS (The export table is populated)</td>
                            </tr>
                            <tr>
                                <td><code class="flag-name">UNCOMPRESSED_XATTRS</code></td>
                                <td>0x0100</td>
                                <td>Xattrs are stored uncompressed</td>
                            </tr>
                            <tr>
                                <td><code class="flag-name">NO_XATTRS</code></td>
                                <td>0x0200</td>
                                <td>Xattrs are not stored</td>
                            </tr>
                            <tr>
                                <td><code class="flag-name">COMPRESSOR_OPTIONS</code></td>
                                <td>0x0400</td>
                                <td>The compression options section is present</td>
                            </tr>
                            <tr>
                                <td><code class="flag-name">UNCOMPRESSED_IDS</code></td>
                                <td>0x0800</td>
                                <td>UID/GIDs are stored uncompressed. Note that the <code class="flag-name">UNCOMPRESSED_INODES</code> flag also has this effect. If that flag is set, this flag has no effect. This flag is currently only available on master in git, no released version of squashfs yet supports it.</td>
                            </tr>
                        </tbody>
                    </table>
                </section>

                <section id="metadata-blocks">
                    <h1>Metadata Blocks</h1>
                    <p>
                        Metadata blocks are compressed in 8KiB blocks. A metadata block is prefixed by a u16 header. The highest bit of the header is set if the block is stored uncompressed (this will happen if the block grew when compressed, or e.g. the <code class="flag-name">UNCOMPRESSED_INODES</code> superblock flag is set). The lower 15 bits specifies the size of the metadata block (not including the header) on disk.
                    </p>
                    <p>
                        To read a metadata block, read a u16. If the highest bit is set (<code>size &amp; 0x8000 == 0x8000</code>) the following data is uncompressed. Mask out the highest bit to get the size of the block data on disk (this should always be &lt;= 8KiB). Read that many bytes. If the data is compressed, uncompress the data. In pseudocode:
                    </p>
                    <pre class="pre-scrollable pseudocode example"><code>header = read_u16(offset=offset)
data_size = header &amp; 0x7FFF
compressed = header &amp; 0x8000
data = read(offset=offset+2, len=data_size)
if(compressed) {
    data = uncompress(data)
}
return data</code></pre>
                    <p>
                        Neither the size on disk, nor the compressed size should exceed 8KiB. The uncompressed size should always be equal to 8KiB, with the exception of the last metadata block of a section, which may have an uncompressed size less than 8KiB.
                    </p>
                </section>

                <section id="compression-options">
                    <h1>Compression Options</h1>
                    <p>
                        If the <code class="flag-name">COMPRESSOR_OPTIONS</code> flag is set, this section will be present immidately after the superblock, otherwise this section will not be present. If this section is present, it consists of a single <a href="#metadata-blocks">metadata block</a>, which is always uncompressed. The data is interpreted differently based on the compressor <span class="avoid-split">(<code class="field-name">compression_id</code>).</span>
                    </p>
                    <div class="row">
                        <div class="col-12">
                            <h4>LZMA</h4>
                            <p>LZMA does not support any compression options</p>
                        </div>
                        <div class="col-12 col-lg-6">
                            <h4>GZIP</h4>
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Type</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>compression_level</td>
                                        <td>i32</td>
                                        <td>Should be in range 1&hellip;9 (inclusive). Defaults to 9.</td>
                                    </tr>
                                    <tr>
                                        <td>window_size</td>
                                        <td>i16</td>
                                        <td>Should be in range 8&hellip;15 (inclusive) Defaults to 15.</td>
                                    </tr>
                                    <tr>
                                        <td>strategies</td>
                                        <td>i16</td>
                                        <td>A bitfield describing the enabled strategies. If no flags are set, the default strategy is implicitly used. Flags:
                                            <table class="table table-sm table-bordered font-weight-light">
                                                <tbody>
                                                    <tr>
                                                        <td>Default</td>
                                                        <td>0x01</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Filtered</td>
                                                        <td>0x02</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Huffman Only</td>
                                                        <td>0x04</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Run Length Encoded</td>
                                                        <td>0x08</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Fixed</td>
                                                        <td>0x10</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="col-12 col-lg-6">
                            <h4>XZ</h4>
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Type</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>dictionary_size</td>
                                        <td>i32</td>
                                        <td>Should be > 8KiB, and must be either the sum of a power of two, or the sum of two sequential powers of two
                                            <span class="avoid-split">(2<sup>n</sup> or 2<sup>n</sup>&nbsp;+&nbsp;2<sup>n+1</sup>)</span></td>
                                    </tr>
                                    <tr>
                                        <td>executable_filters</td>
                                        <td>i32</td>
                                        <td>A bitfield describing the additional enabled filters attempted to better compress executable code. Flags:
                                            <table class="table table-sm table-bordered font-weight-light">
                                                <tbody>
                                                    <tr>
                                                        <td>x86</td>
                                                        <td>0x01</td>
                                                    </tr>
                                                    <tr>
                                                        <td>powerpc</td>
                                                        <td>0x02</td>
                                                    </tr>
                                                    <tr>
                                                        <td>ia64</td>
                                                        <td>0x04</td>
                                                    </tr>
                                                    <tr>
                                                        <td>arm</td>
                                                        <td>0x08</td>
                                                    </tr>
                                                    <tr>
                                                        <td>armthumb</td>
                                                        <td>0x10</td>
                                                    </tr>
                                                    <tr>
                                                        <td>sparc</td>
                                                        <td>0x20</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="col-12 col-lg-6">
                            <h4>LZ4</h4>
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Type</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>version</td>
                                        <td>i32</td>
                                        <td>The only supported value is 1 (<code>LZ4_LEGACY</code>)</td>
                                    </tr>
                                    <tr>
                                        <td>flags</td>
                                        <td>i32</td>
                                        <td>A bitfield describing the enabled LZ4 flags. There is currently only one possible flag:
                                            <table class="table table-sm table-bordered font-weight-light">
                                                <tbody>
                                                    <tr>
                                                        <td>Use LZ4 High Compression(HC) mode</td>
                                                        <td>0x01</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="col-12 col-lg-6">
                            <h4>ZSTD</h4>
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Type</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>compression_level</td>
                                        <td>i32</td>
                                        <td>Should be in range 1..22 (inclusive). The real maximum is the zstd defined <code>ZSTD_maxCLevel()</code></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <section id="datablocks-and-fragments">
                    <h1>Datablocks and Fragments</h1>
                    <p>
                        Datablocks and fragments contain the data which is contained by the files in this archive. A single file's data is stored in a number of data blocks, which are stored sequentially in this section. Because blocks are stored sequentially, the inode for a file only needs to store the position of the first block, and the compressed sizes of each block. All data blocks must be of size <code class="field-name">block_size</code>, unless fragments are not used and the file size is not equally divisible by <code class="field-name">block_size</code>.
                    </p>
                    <p>
                        In addition to full data blocks, files can optionally end in a fragment, if fragments are enabled (<a href="#superblock-flags"><code class="flag-name">NO_FRAGMENTS</code></a> is not set). Fragments are combined into data blocks of at most size <code class="field-name">block_size</code>, and compressed as a single block (unless compression fails to shrink the fragment block).
                    </p>
                    <p>
                        Datablocks do not have headers. Information about the size and position of datablocks is stored in the inode of the file to which the datablocks belong. Information about the size and position of fragment blocks are stored in the <a href="#fragment-table">Fragment Table</a>, and the size and offset of fragments within the blocks are stored in the inode of the file to which the fragment belongs.
                    </p>
                    <p>
                        In both the fragment table, and file inodes, the size of a data block is represented by a u32. If the <code>1 &lt;&lt; 24</code> bit is set, the data block is stored uncompressed. The size of the block on disk is described by this u32 when this bit is masked out, though the value should always be less than the max block size (1MiB). Additionally, if this size is 0, no actual block is stored, but can be considered to uncompress to a stream of zeros of whatever size is needed (<code class="field-name">block_size</code> in most cases).
                    </p>
                </section>
                <section id="inode-table">
                    <h1>Inode Table</h1>
                    <p>
                        The inode table starts at <code class="field-name">inode_table_start</code> and ends at <code class="field-name">directory_table_start</code>. In this range are stored enough <a href="#metadata-blocks">metadata blocks</a> to contain all inodes. All metablocks in the table (except for the last block) should have an uncompressed size of 8KiB.
                    </p>
                    <p>
                        Inodes are packed into metadata blocks. Inodes are not aligned to block boundaries, and can therefore span the boundary between metadata blocks. To maximise compression there are different inodes for each item type (regular file, directory, device, etc.), the inode contents and length varying with the type.
                    </p>
                    <p>
                        To further maximise compression, inodes come in two flavors: simple inode types optimised for frequently occurring items, and extended inode types where extra information has to be stored.
                    </p>
                    <p>
                        If the <code class="flag-name">UNCOMPRESSED_INODES</code> flag is set, all metadata blocks should stored uncompressed. If the flag is not set, metadata blocks will be stored compressed if compression decreases the size of the block as described in the <a href="#metadata-blocks">metadata block section</a>.
                    </p>

                    <h3 id="inode-references">Inode References</h3>
                    <p>
                        Entries in the Inode table are referenced (for example, in directory entries) with u64 values. The upper 16 bits are unused. The next 32 bits describe the index of the metadata block. The lower 16 bits describe the (uncompressed) offset within the metadata block where the inode <strong>begins</strong> (remember that an inode may straddle the border between two metadata blocks). For example, an inode reference with the value <code class="avoid-split">0x0000_000001FF_01A0</code> will be located in the metadata block at index <code>0x000001FF</code> (the 512th block), starting at the byte at index <code>0x01A0</code> (the 417th byte) when the block is uncompressed.
                    </p>

                    <h3 id="inode-header">Inode Header</h3>
                    <p>
                        All Inodes share a common header, which contains some common information, as well as describing the type of Inode which follows. This header has the following structure:
                    </p>
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Type</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>inode_type</td>
                                <td>u16<br/>(<a href="#inode-types">InodeType</a>)</td>
                                <td>The type of item described by the inode which follows this header.</td>
                            </tr>
                            <tr>
                                <td>permissions</td>
                                <td>u16<br/>(<a href="#TODO-permissions-type">Permissions</a>)</td>
                                <td>A bitmask representing the permissions for the item described by the inode. The values match with the permission values of <a href="http://pubs.opengroup.org/onlinepubs/7908799/xsh/sysstat.h.html">mode_t</a> (the mode bits, not the file type)</td>
                            </tr>
                            <tr>
                                <td>uid_idx</td>
                                <td>u16</td>
                                <td>The index of the user id in the <a href="#id-table">UID/GID Table</a></td>
                            </tr>
                            <tr>
                                <td>gid_idx</td>
                                <td>u16</td>
                                <td>The index of the group id in the <a href="#id-table">UID/GID Table</a></td>
                            </tr>
                            <tr>
                                <td>modified_time</td>
                                <td>i32</td>
                                <td>The number of seconds (not counting leap seconds) since 00:00, Jan&nbsp;1&nbsp;1970 UTC when the item described by the inode was last modified</td>
                            </tr>
                            <tr>
                                <td>inode_number</td>
                                <td>u32</td>
                                <td>The position of this inode in the full list of inodes. Value should be in the range <span class="avoid-split"><code>[1, <span class="field-name">inode_count</span>]</code>
                                    </span>(from the <a href="#superblock">superblock</a>) This can be treated as a unique identifier for this inode, and can be used as a key to recreate hard links: when processing the archive, remember the visited values of <code>inode_number</code>. If an inode number has already been visited, this inode is hardlinked</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3 id="inode-types">Inode Types</h3>
                    <p>
                        There are seven types of inodes, and each type comes in two variants, a basic variant which is smaller and contains only the most-used properties, and an extended variant which has more properties, and will be used when those less used properties are required (e.g. xattrs). Note that some inodes types are variable sized (symlinks targets, sizes of file data blocks, etc).
                    </p>
                    <p>
                        The value of <code class="field-name">inode_type</code> (in the <a href="#inode-header">inode header</a>) can have any of the following values:
                    </p>
                    <div class="row">
                        <div class="col-12 col-sm-6 col-lg-3">1&nbsp;-&nbsp;<a href="#inode-directory-basic">Basic Directory</a></div>
                        <div class="col-12 col-sm-6 col-lg-3">2&nbsp;-&nbsp;<a href="#inode-file-basic">Basic File</a></div>
                        <div class="col-12 col-sm-6 col-lg-3">3&nbsp;-&nbsp;<a href="#inode-symlink-basic">Basic Symlink</a></div>
                        <div class="col-12 col-sm-6 col-lg-3">4&nbsp;-&nbsp;<a href="#inode-device-basic">Basic Block Device</a></div>
                        <div class="col-12 col-sm-6 col-lg-3">5&nbsp;-&nbsp;<a href="#inode-device-basic">Basic Char Device</a></div>
                        <div class="col-12 col-sm-6 col-lg-3">6&nbsp;-&nbsp;<a href="#inode-ipc-basic">Basic Fifo</a></div>
                        <div class="col-12 col-sm-6 col-lg-3">7&nbsp;-&nbsp;<a href="#inode-ipc-basic">Basic Socket</a></div>
                        <div class="col-12 col-sm-6 col-lg-3">8&nbsp;-&nbsp;<a href="#inode-directory-extended">Extended Directory</a></div>
                        <div class="col-12 col-sm-6 col-lg-3">9&nbsp;-&nbsp;<a href="#inode-file-extended">Extended File</a></div>
                        <div class="col-12 col-sm-6 col-lg-3">10&nbsp;-&nbsp;<a href="#inode-symlink-extended">Extended Symlink</a></div>
                        <div class="col-12 col-sm-6 col-lg-3">11&nbsp;-&nbsp;<a href="#inode-device-extended">Extended Block Device</a></div>
                        <div class="col-12 col-sm-6 col-lg-3">12&nbsp;-&nbsp;<a href="#inode-device-extended">Extended Char Device</a></div>
                        <div class="col-12 col-sm-6 col-lg-3">13&nbsp;-&nbsp;<a href="#inode-ipc-extended">Extended Fifo</a></div>
                        <div class="col-12 col-sm-6 col-lg-3">14&nbsp;-&nbsp;<a href="#inode-ipc-extended">Extended Socket</a></div>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col-12 col-lg-6">
                            <h5 id="inode-directory-basic">Basic Directory</h5>
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Type</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>start_block</td>
                                        <td>u32</td>
                                        <td>The index of the block in the <a href="#directory-table">Directory Table</a> where the directory entry information starts</td>
                                    </tr>
                                    <tr>
                                        <td>nlink</td>
                                        <td>u32</td>
                                        <td>The number of hard links to this directory</td>
                                    </tr>
                                    <tr>
                                        <td>file_size</td>
                                        <td>u16</td>
                                        <td>TODO: Check meaning</td>
                                    </tr>
                                    <tr>
                                        <td>offset</td>
                                        <td>u16</td>
                                        <td>The (uncompressed) offset within the block in the <a href="#directory-table">Directory Table</a> where the directory entry information starts</td>
                                    </tr>
                                    <tr>
                                        <td>parent_inode_number</td>
                                        <td>u32</td>
                                        <td>The <code class="field-name">inode_number</code> of the parent of this directory. If this is the root directory, this will be 1</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="col-12 col-lg-6">
                            <h5 id="inode-directory-extended">Extended Directory</h5>
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Type</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>nlink</td>
                                        <td>u32</td>
                                        <td>The number of hard links to this directory</td>
                                    </tr>
                                    <tr>
                                        <td>file_size</td>
                                        <td>u32</td>
                                        <td>TODO: Check meaning</td>
                                    </tr>
                                    <tr>
                                        <td>start_block</td>
                                        <td>u32</td>
                                        <td>The index of the block in the <a href="#directory-table">Directory Table</a> where the directory entry information starts</td>
                                    </tr>
                                    <tr>
                                        <td>parent_inode_number</td>
                                        <td>u32</td>
                                        <td>The <code class="field-name">inode_number</code> of the parent of this directory. If this is the root directory, this will be 1</td>
                                    </tr>
                                    <tr>
                                        <td>index_count</td>
                                        <td>u16</td>
                                        <td>The number of directory indexes. TODO: More Info. May be related to exports?</td>
                                    </tr>
                                    <tr>
                                        <td>offset</td>
                                        <td>u16</td>
                                        <td>The (uncompressed) offset within the block in the <a href="#directory-table">Directory Table</a> where the directory entry information starts</td>
                                    </tr>
                                    <tr>
                                        <td>xattr_index</td>
                                        <td>u32</td>
                                        <td>A reference to inode information in the xattr table. TODO: More info after learning about the xattr table</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="col-12 col-lg-6">
                            <h5 id="inode-file-basic">Basic File</h5>
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Type</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>blocks_start</td>
                                        <td>u32</td>
                                        <td>The offset from the start of the archive where the data blocks are stored</td>
                                    </tr>
                                    <tr>
                                        <td>fragment_block_index</td>
                                        <td>u32</td>
                                        <td>The index of a fragment entry in the <a href="fragment-table">fragment table</a> which describes the data block the fragment of this file is stored in. If this file does not end with a fragment, this should be 0xFFFFFFFF</td>
                                    </tr>
                                    <tr>
                                        <td>fragment_offset</td>
                                        <td>u32</td>
                                        <td>The (uncompressed) offset within the fragment data block where the fragment for this file. Information about the fragment can be found at <code class="field-name">fragment_block_index</code>. The size of the fragment can be found as <code><span class="field-name">file_size</span> % <span class="avoid-split">superblock.<span class="field-name">block_size</span></span></code> If this file does not end with a fragment, the value of this field is undefined (probably zero)</td>
                                    </tr>
                                    <tr>
                                        <td>file_size</td>
                                        <td>u32</td>
                                        <td>The (uncompressed) size of this file</td>
                                    </tr>
                                    <tr>
                                        <td>block_sizes</td>
                                        <td>u32[]</td>
                                        <td>A list of block sizes. If this file ends in a fragment, the size of this list is the number of <em>full</em> data blocks needed to store <code class="field-name">file_size</code> bytes. If this file does not have a fragment, the size of the list is the number of blocks needed to store <code class="field-name">file_size</code> bytes, rounded up. Each item in the list describes the (possibly compressed) size of a block. See <a href="#datablocks-and-fragments">datablocks &amp; fragments</a> for information about how to interpret this size.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="col-12 col-lg-6">
                            <h5 id="inode-file-extended">Extended File</h5>
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Type</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>blocks_start</td>
                                        <td>u64</td>
                                        <td>The offset from the start of the archive where the data blocks are stored</td>
                                    </tr>
                                    <tr>
                                        <td>file_size</td>
                                        <td>u64</td>
                                        <td>The (uncompressed) size of this file</td>
                                    </tr>
                                    <tr>
                                        <td>sparse</td>
                                        <td>u64</td>
                                        <td>TODO</td>
                                    </tr>
                                    <tr>
                                        <td>nlink</td>
                                        <td>u32</td>
                                        <td>The number of hard links to this directory</td>
                                    </tr>
                                    <tr>
                                        <td>fragment_block_index</td>
                                        <td>u32</td>
                                        <td>The index of a fragment entry in the <a href="fragment-table">fragment table</a> which describes the data block the fragment of this file is stored in. If this file does not end with a fragment, this should be 0xFFFFFFFF</td>
                                    </tr>
                                    <tr>
                                        <td>fragment_offset</td>
                                        <td>u32</td>
                                        <td>The (uncompressed) offset within the fragment data block where the fragment for this file. Information about the fragment can be found at <code class="field-name">fragment_block_index</code>. If this file does not end with a fragment, the value of this field is undefined (probably zero)</td>
                                    </tr>
                                    <tr>
                                        <td>xattr_index</td>
                                        <td>u32</td>
                                        <td>A reference to inode information in the xattr table. TODO: More info after learning about the xattr table</td>
                                    </tr>
                                    <tr>
                                        <td>block_sizes</td>
                                        <td>u32[]</td>
                                        <td>A list of block sizes. If this file ends in a fragment, the size of this list is the number of <em>full</em> data blocks needed to store <code class="field-name">file_size</code> bytes. If this file does not have a fragment, the size of the list is the number of blocks needed to store <code class="field-name">file_size</code> bytes, rounded up. Each item in the list describes the (possibly compressed) size of a block. See <a href="#datablocks-and-fragments">datablocks &amp; fragments</a> for information about how to interpret this size.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="col-12 col-lg-6">
                            <h5 id="inode-symlink-basic">Basic Symlink</h5>
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Type</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>nlink</td>
                                        <td>u32</td>
                                        <td>The number of hard links to this symlink</td>
                                    </tr>
                                    <tr>
                                        <td>target_size</td>
                                        <td>u32</td>
                                        <td>The size in bytes of the <code class="field-name">target_path</code> this symlink points to</td>
                                    </tr>
                                    <tr>
                                        <td>target_path</td>
                                        <td>u8[]</td>
                                        <td>The target path this symlink points to. This path is <code class="field-name">target_size</code> bytes long. There is no trailing null byte, and interior null bytes should not be allowed (however, this is currently not checked by unsquashfs)</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="col-12 col-lg-6">
                            <h5 id="inode-symlink-extended">Extended Symlink</h5>
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Type</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>nlink</td>
                                        <td>u32</td>
                                        <td>The number of hard links to this symlink</td>
                                    </tr>
                                    <tr>
                                        <td>target_size</td>
                                        <td>u32</td>
                                        <td>The size in bytes of the <code class="field-name">target_path</code> this symlink points to</td>
                                    </tr>
                                    <tr>
                                        <td>target_path</td>
                                        <td>u8[]</td>
                                        <td>The target path this symlink points to. This path is <code class="field-name">target_size</code> bytes long. There is no trailing null byte, and interior null bytes should not be allowed (however, this is currently not checked by unsquashfs)</td>
                                    </tr>
                                    <tr>
                                        <td>xattr_index</td>
                                        <td>u32</td>
                                        <td>A reference to inode information in the xattr table. TODO: More info after learning about the xattr table</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="col-12 col-lg-6">
                            <h5 id="inode-device-basic">Basic Device (Block/Char)</h5>
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Type</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>nlink</td>
                                        <td>u32</td>
                                        <td>The number of hard links to this device</td>
                                    </tr>
                                    <tr>
                                        <td>device</td>
                                        <td>u32</td>
                                        <td>To extract the major device number, <code>(device &amp; 0xfff00) &gt;&gt; 8</code>. To extract the minor device number, use <code>(dev &amp; 0xff) | ((dev &gt;&gt; 12) &amp; 0xfff00)</code></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="col-12 col-lg-6">
                            <h5 id="inode-device-extended">Extended Device (Block/Char)</h5>
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Type</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>nlink</td>
                                        <td>u32</td>
                                        <td>The number of hard links to this device</td>
                                    </tr>
                                    <tr>
                                        <td>device</td>
                                        <td>u32</td>
                                        <td>To extract the major device number, <code>(device &amp; 0xfff00) &gt;&gt; 8</code>. To extract the minor device number, use <code>(dev &amp; 0xff) | ((dev &gt;&gt; 12) &amp; 0xfff00)</code></td>
                                    </tr>
                                    <tr>
                                        <td>xattr_index</td>
                                        <td>u32</td>
                                        <td>A reference to inode information in the xattr table. TODO: More info after learning about the xattr table</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="col-12 col-lg-6">
                            <h5 id="inode-ipc-basic">Basic IPC (Fifo/Socket)</h5>
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Type</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>nlink</td>
                                        <td>u32</td>
                                        <td>The number of hard links to this ipc item</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="col-12 col-lg-6">
                            <h5 id="inode-ipc-extended">Extended IPC (Fifo/Socket)</h5>
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Type</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>nlink</td>
                                        <td>u32</td>
                                        <td>The number of hard links to this ipc item</td>
                                    </tr>
                                    <tr>
                                        <td>xattr_index</td>
                                        <td>u32</td>
                                        <td>A reference to inode information in the xattr table. TODO: More info after learning about the xattr table</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <section id="fragment-table">
                    <h1>Fragment Table</h1>
                    <p>
                        Fragments are combined into fragment blocks of at most <code class="field-name">block_size</code> bytes long. This table describes the location and size of these fragment blocks, not the fragments within them.
                    </p>
                    <p>
                        This table is stored in two levels: The fragment block entries are stored in <a href="#metadata-blocks">metadata blocks</a>, and the file offsets to these metadata blocks are stored at the offset specified by the <code class="field-name">fragment_table_start</code> field of the superblock.
                    </p>
                    <p>
                        Each metadata block can store 512 fragment block entries (16 bytes per fragment block entry), so there will be
                        <code>ceil(<span class="field-name">fragment_entry_count</span> / 512.0)</code> metadata blocks (and the same number of u64 offsets stored at
                        <code class="field-name">fragment_table_start</code>)
                    </p>
                    <p>
                        To read the list of fragment block entries, read <code>ceil(<span class="field-name">fragment_entry_count</span> / 512.0)</code> u64 offsets starting at
                        <code class="field-name">fragment_table_start</code>, then read the metadata blocks at the offsets read, interpreting the data of the metadata blocks as a packed array of fragment block entries.
                    </p>
                    <h4>Fragment Block Entry</h4>
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Type</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>start</td>
                                <td>u64</td>
                                <td>The offset within the archive where the fragment block starts</td>
                            </tr>
                            <tr>
                                <td>size</td>
                                <td>u32</td>
                                <td>This stores two pieces of information. If the block is uncompressed, the 0x1000000 (1&lt;&lt;24) bit wil be set. The remaining bits describe the size of the fragment block on disk. Because the max value of <code class="field-name">block_size</code> is 1 MiB (1&lt;&lt;20), and the size of a fragment block should be less than <code class="field-name">block_size</code>, the uncompressed bit will never be set by the size.</td>
                            </tr>
                            <tr>
                                <td>_unused</td>
                                <td>u32</td>
                                <td>This field is unused</td>
                            </tr>
                        </tbody>
                    </table>
                </section>

                <section id="id-table">
                    <h1>UID/GID Table</h1>
                    <p>
                        UID/GIDs are both stored as u32s. Both UIDs and GIDs are treated as IDs, if a file is owned by user 1000, and group 1000, the ID 1000 will be stored only once. UID/GIDs in inodes are stored as u16 indexes into this table (and thus, a maximum of 65535 unique IDs may be stored).
                    </p>
                    <p>
                        This table is stored in two levels: The IDs are stored in <a href="#metadata-blocks">metadata blocks</a>, and the file offsets to these metadata blocks are stored at the offset specified by the <code class="field-name">id_table_start</code> field of the superblock.
                    </p>
                    <p>
                        Each metadata block can store 2048 UID/GIDs (4 bytes per ID), so there will be <code>ceil(<span class="field-name">id_count</span> / 2048.0)</code> metadata blocks used for IDs (and the same number of u64 offsets stored at <code class="field-name">id_table_start</code>).
                    </p>
                    <p>
                        To read the list of IDs, read <code>ceil(<span class="field-name">id_count</span> / 2048.0)</code> u64 offsets starting at
                        <code class="field-name">id_table_start</code>, then read the metadata blocks at the offsets read.
                    </p>
                </section>
            </div>
        </div>

    </div>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</body>

</html>
